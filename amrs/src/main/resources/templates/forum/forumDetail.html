<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
	  layout:decorate="~{layout/layout.html}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Forum Detail</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        .forum-container {
            max-width: 800px;
            margin: 50px auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .forum-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .forum-header h1 {
            font-size: 2.5rem;
            color: #333;
        }

        .forum-meta {
            text-align: center;
            color: #777;
            font-size: 0.9rem;
        }

        .forum-content {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #444;
            margin-bottom: 40px;
        }

        .like-section {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 30px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .forum-container {
                padding: 15px;
            }

            .forum-header h1 {
                font-size: 2rem;
            }

            .forum-content {
                font-size: 1rem;
            }
        }
	    .like-button {
	        display: inline-flex;
	        align-items: center;
	        background-color: transparent;
	        border: none;
	        font-size: 1.5rem;
	        cursor: pointer;
	        transition: color 0.3s ease;
	    }
	
	    .fa-heart {
	        font-size: 2rem;
	        color: #ccc; /* 기본 빈 하트 색상 */
	        transition: color 0.3s ease;
	    }
	
	    .liked .fa-heart {
	        color: red; /* 좋아요 누르면 빨간 하트 */
	    }
	
	    .like-count {
	        margin-left: 10px;
	        font-size: 1.2rem;
	        color: #333;
	    }
    </style>
    <script th:src="@{/jquery/jquery-3.7.1.min.js}"></script>
    <!-- Simple JavaScript for Like Button -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let likeCount = parseInt(document.getElementById('likeCount').textContent);
            let isLiked = $('#likeCount').val();
            console.log(isLiked);

            document.querySelector('.like-button').addEventListener('click', function() {
                const likeIcon = document.getElementById('likeIcon');
                const likeCountElem = document.getElementById('likeCount');
                const forumId = document.querySelector('[name="forumId"]').value;

                if (isLiked) {
                    likeIcon.classList.remove('fas');
                    likeIcon.classList.add('far');
                    likeCount--;
                } else {
                    likeIcon.classList.remove('far');
                    likeIcon.classList.add('fas');
                    likeCount++;
                }

                isLiked = !isLiked;
                likeCountElem.textContent = likeCount;
                
            	$.ajax({
            		
            		url: '/like/likeCount/' + forumId,
            		type: 'post',
            		contentType: 'application/json; charset=utf-8',
            		data: JSON.stringify({ 
            			'likeCount': likeCount, 
            			'isLiked': isLiked
           			}),
            		success: function(response) {
                        // 서버로부터 응답이 성공적으로 왔을 때 처리
                        // 서버에서 좋아요 처리 후 새로운 카운트를 반환할 수 있음
                        likeCount = response.updatedLikeCount;  // 서버에서 새로운 카운트 값을 받아 업데이트
                        $('#likeCount').text(likeCount);  // 좋아요 카운트 화면에 표시
                        console.log('서버 응답: ', response);
                    },
                    error: function(xhr, status, error) {
                        // 오류가 발생했을 때 처리
                        console.log('Error occurred: ' + error);
                    }
            		
            	});
            });
        });
    </script>
    
</head>
<body>

    <div layout:fragment="content">
    	<div class="forum-background">
        <div class="forum-container">
            <div class="forum-header">
                <!-- forum Title -->
                <div class="dropdown noto-serif-kr" style="width: 1rem; float: right; list-style: none;">
                    <a data-bs-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                        <i class="fa-solid fa-bars"></i></a>
                    <div class="dropdown-menu" th:if="${session.memberId != null and session.memberId == forum['memberId']}" >
                        <span class="dropdown-item-text">
                            <a th:href="@{/forum/modifyForum/{forumId}(forumId=${forum['forumId']})}">수정하기</a>
                        </span>
                        <span class="dropdown-item-text">
                            <a th:href="@{/forum/removeForum}">삭제하기</a>
                        </span>
                    </div>
                </div>
                <h1 class="noto-serif-kr" th:text="${forum['forumTitle']}"></h1>
            </div>
			<input type="hidden" name="forumId" th:value="${forum['forumId']}">
            <div class="forum-meta">
                <!-- forum Meta Data -->
                <p class="noto-serif-kr">
                    작성자: <span th:text="${memberNm}"></span> &bull;
                    작성일: <span th:text="${#dates.format(forum.createDt, 'yyyy-MM-dd')}"></span>
                </p>
            </div>

            <div class="forum-content noto-serif-kr">
                <!-- forum Content -->
                <p style="padding: 1rem;" th:text="${forum['forumContent']}"></p>
            </div>
			<input type="button" value="목록보기" class="btn noto-serif-kr" th:onclick="|location.href='@{/forum/forumMain}'|">
			
			<input type="hidden" id="isLiked" value="${isLiked}">

            <div class="like-section">
			    <button class="like-button">
			        <i id="likeIcon" th:classappend="${isLiked != false} ? 'fas fa-heart' : 'far fa-heart'"></i>
			    </button>
			    <span class="like-count" id="likeCount" th:text="${forum['likeCount']}"></span>
			</div>
        </div>
        </div>
    </div>
</body>
</html>
